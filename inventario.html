<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VentaLite - Inventario</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Volver</a>
        
        <div class="header">
            <span class="icon">üóÉÔ∏è</span>
            <h2>Inventario y ventas</h2>
        </div>

        <div id="productList" class="product-list">
            <!-- Los productos se cargar√°n aqu√≠ -->
        </div>

        <div id="emptyState" class="empty-state" style="display: none;">
            <div class="icon">üì¶</div>
            <p>No hay productos agregados</p>
            <a href="agregar.html">
                <button class="btn-primary">Agregar primer producto</button>
            </a>
        </div>

        <!-- Botones de acci√≥n al final -->
        <div id="actionButtons" class="action-buttons" style="display: none;">
            <button class="btn-confirm-all" onclick="confirmAllSales()">
                ‚úì Confirmar venta(s)
            </button>
            <a href="resumen.html" class="btn-summary">
                üìä Ir a resumen del d√≠a
            </a>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n de venta -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3>¬øDeseas confirmar esta venta?</h3>
            <p id="modalMessage"></p>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
                <button class="btn-confirm-modal" onclick="confirmSale()">Confirmar ‚úì</button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n de eliminaci√≥n -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>¬øEliminar producto?</h3>
            <p id="deleteModalMessage"></p>
            <div class="modal-buttons">
                <button class="btn-cancel" onclick="closeDeleteModal()">Cancelar</button>
                <button class="btn-confirm-modal" onclick="confirmDelete()">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- Notificaci√≥n de √©xito -->
    <div id="successNotification" class="success-notification">
        <span class="check-icon">‚úì</span>
    </div>

<script src="app.js"></script>
<script>
    let pendingDeleteIndex = null;

    function renderInventory() {
        const products = getProducts();
        const productList = document.getElementById('productList');
        const emptyState = document.getElementById('emptyState');
        const actionButtons = document.getElementById('actionButtons');

        if (products.length === 0) {
            productList.style.display = 'none';
            emptyState.style.display = 'block';
            actionButtons.style.display = 'none';
            return;
        }

        productList.style.display = 'flex';
        emptyState.style.display = 'none';
        actionButtons.style.display = 'block';

        productList.innerHTML = products.map((product, index) => {
            const lowStock = product.currentQuantity <= 3 && product.currentQuantity > 0;

            return `
                <div class="product-item">
                    <div class="product-header-row">
                        <div class="product-name">${product.name}</div>
                        <button class="btn-delete" onclick="openDeleteModal(${index})" title="Eliminar producto">
                            üóëÔ∏è
                        </button>
                    </div>
                    
                    ${lowStock ? '<div class="stock-alert">‚ö†Ô∏è Quedan pocas piezas</div>' : ''}
                    
                    <div class="product-info-row">
                        <div>Disponibles: <strong id="stock-${index}">${product.currentQuantity}</strong></div>
                    </div>
                    
                    <div class="product-sale-row">
                        <div>Vendidos hoy: <strong id="sold-${index}">${product.soldToday || 0}</strong></div>
                        <div class="quantity-control">
                            <button class="btn-quantity btn-minus" onclick="adjustQuantity(${index}, -1)">‚àí</button>
                            <input type="number" class="quantity-input" id="qty-${index}" value="0" min="0" max="${product.currentQuantity}" />
                            <button class="btn-quantity btn-plus" onclick="adjustQuantity(${index}, 1)">+</button>
                        </div>
                    </div>
                    
                    <div class="product-info-row">
                        <div>Precio: <strong>${product.price.toFixed(2)}</strong></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function adjustQuantity(index, change) {
        const products = getProducts();
        const product = products[index];
        const qtyInput = document.getElementById(`qty-${index}`);
        const stockDisplay = document.getElementById(`stock-${index}`);
        const soldDisplay = document.getElementById(`sold-${index}`);

        let qty = parseInt(qtyInput.value) || 0;
        let currentStock = product.currentQuantity;
        let soldToday = product.soldToday || 0;

        if (change === 1 && currentStock > 0) {
            qty++;
            product.currentQuantity--;
            product.soldToday++;
        } else if (change === -1 && qty > 0) {
            qty--;
            product.currentQuantity++;
            product.soldToday--;
        }

        qtyInput.value = qty;
        stockDisplay.textContent = product.currentQuantity;
        soldDisplay.textContent = product.soldToday;

        saveProducts(products);
    }

    function confirmAllSales() {
        const products = getProducts();
        const totalSold = products.reduce((sum, p) => sum + (p.soldToday || 0), 0);
        if (totalSold === 0) {
            alert("No se ha realizado ninguna venta.");
            return;
        }
        showSuccessNotification();
        alert("Ventas confirmadas correctamente ‚úÖ");
        renderInventory();
    }

    function openDeleteModal(index) {
        const products = getProducts();
        const product = products[index];
        pendingDeleteIndex = index;

        document.getElementById('deleteModalMessage').textContent =
            `¬øEst√°s seguro de eliminar "${product.name}"? Esta acci√≥n no se puede deshacer.`;

        document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
        pendingDeleteIndex = null;
    }

    function confirmDelete() {
        if (pendingDeleteIndex !== null) {
            deleteProduct(pendingDeleteIndex);
            closeDeleteModal();
            showSuccessNotification();
            renderInventory();
        }
    }

    renderInventory();
</script>
</body>
</html>